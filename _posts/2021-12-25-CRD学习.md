---
layout: post
keywords: CustomResourceDefinition 
description: 学习CRD相关内容
title: CustomResourceDefinition
categories: [kubernetes]
tags: [CRD]
group: archive
icon: google
---
{% include sunminghui81/setup %}

## CustomResourceDefinition 
### GVK
<img src="/image/kubernetes/crd-gvk.png" alt="broadcasting" width="70%" height="70%"/>
### 结构
<img src="/image/kubernetes/crd_level_1_items.png" alt="broadcasting" width="70%" height="70%"/>

## 创建 CustomResourceDefinition
当我们创建一个新的CustomResourceDefinition（CRD）时，k8s api服务会为我们指定的每一个版本生成一个  
RESTful的资源路径。CRD中spec指定的scope字段，决定了CRD的作用域（namespace还是cluster）。  
CustomResourceDefinition本身是不受作用域限制的，对所有集群和namespace都可见。  

### CRD示例
```console
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  # 名字必需与下面的 spec 字段匹配，并且格式为 '<名称的复数形式>.<组名>'
  name: crontabs.stable.example.com
spec:
  # 组名称，用于 REST API: /apis/<组>/<版本>
  group: stable.example.com
  # 列举此 CustomResourceDefinition 所支持的版本
  versions:
    - name: v1
      # 每个版本都可以通过 served 标志来独立启用或禁止
      served: true
      # 其中一个且只有一个版本必需被标记为存储版本
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              properties:
                cronSpec:
                  type: string
                image:
                  type: string
                replicas:
                  type: integer
  # 可以是 Namespaced 或 Cluster
  scope: Namespaced
  names:
    # 名称的复数形式，用于 URL：/apis/<组>/<版本>/<名称的复数形式>
    plural: crontabs
    # 名称的单数形式，作为命令行使用时和显示时的别名
    singular: crontab
    # kind 通常是单数形式的帕斯卡编码（PascalCased）形式。你的资源清单会使用这一形式。
    kind: CronTab
    # shortNames 允许你在命令行使用较短的字符串来匹配资源
    shortNames:
    - ct
```

受命名空间所约束的restful api端点会被创建在：
```console
/apis/[group]]/v1/namespaces/*/[plural]/...
```

## 




## 参考资料
1. [官方文档](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.23/#-strong-write-operations-customresourcedefinition-v1-apiextensions-k8s-io-strong-)
2. [使用 CustomResourceDefinition 扩展 Kubernetes API](https://kubernetes.io/zh/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/)